Imports ClosedXML.Excel
Imports System
Imports System.Reflection

Public Class ExcelExporter
    Public Shared Sub ExportToExcel(Of T)(data As T, filePath As String)
        Using workbook As New XLWorkbook()
            Dim worksheet As IXLWorksheet = workbook.Worksheets.Add("Data")

            ' Recursively add headers and data for complex nested objects
            ExportProperties(worksheet, data, 1)

            ' Save the Excel file
            workbook.SaveAs(filePath)
        End Using
    End Sub

    Private Shared Sub ExportProperties(sheet As IXLWorksheet, obj As Object, startRow As Integer, Optional prefix As String = "")
        Dim properties = obj.GetType().GetProperties()

        For Each prop In properties
            Dim value = prop.GetValue(obj)
            Dim row = startRow
            sheet.Cell(row, 1).Value = prefix & prop.Name

            If value Is Nothing Then
                sheet.Cell(row, 2).Value = DBNull.Value
            ElseIf IsSimpleType(prop.PropertyType) Then
                sheet.Cell(row, 2).Value = value
            Else
                ExportProperties(sheet, value, row + 1, prefix & prop.Name & ".")
            End If
        Next
    End Sub

    Private Shared Function IsSimpleType(type As Type) As Boolean
        Return type.IsValueType OrElse
               type Is GetType(String) OrElse
               type Is GetType(Decimal) OrElse
               type Is GetType(DateTime)
    End Function
End Class
