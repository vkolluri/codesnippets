Class SurroundingClass
    Private Shared Sub DiscoverColumnsEnhanced(ByVal dt As DataTable, ByVal token As JToken, ByVal Optional parentName As String = "")
        Dim jObject As JObject = Nothing, jArray As JArray = Nothing

        If TypeOf token Is JValue Then
            AddColumn(dt, parentName)
        ElseIf CSharpImpl.__Assign(jObject, TryCast(token, JObject)) IsNot Nothing Then

            For Each [property] In jObject.Properties()
                DiscoverColumnsEnhanced(dt, [property].Value, Concat(parentName, [property].Name))
            Next
        ElseIf CSharpImpl.__Assign(jArray, TryCast(token, JArray)) IsNot Nothing Then
            Dim allProperties = New HashSet(Of String)()

            For Each child In jArray.Children(Of JObject)()

                For Each [property] In child.Properties()
                    allProperties.Add([property].Name)
                Next
            Next

            For Each propName In allProperties
                AddColumn(dt, Concat(parentName, propName))
            Next
        End If
    End Sub

    Private Class CSharpImpl
        <Obsolete("Please refactor calling code to use normal Visual Basic assignment")>
        Shared Function __Assign(Of T)(ByRef target As T, value As T) As T
            target = value
            Return value
        End Function
    End Class
End Class
